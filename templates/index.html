<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0">
    <link rel="stylesheet" href="/static/style.css">
    <title>Mes Burgers</title>
</head>
<body>
<main class="three-part">
    <nav class="navbar">
        <div class="left-section">
            <a href="{{ url_for('index') }}">
                <img src="/static/images/logo.png" class="navbar-brand"  alt="My Burger Logo"/>
            </a>
        </div>
        <div class="middle-section">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link {% if request.endpoint == 'index' %}active{% endif %}" href="{{ url_for('index') }}">Maison du chef</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.endpoint == 'my_burgers' %}active{% endif %}" href="{{ url_for('my_burgers') }}">Voir mes burgers</a>
                </li>
            </ul>
        </div>
        <div class="right-section">
            {% if session.get('user_id') %}
                <a class="nav-link" href="{{ url_for('logout') }}">Se d√©connecter</a>
            {% else %}
                <a class="nav-link {% if request.endpoint == 'login' %}active{% endif %}" href="{{ url_for('login') }}">Se connecter</a>
            {% endif %}
        </div>
    </nav>
    <div class="panel left-panel">
        <div class="container">
            <h2>Tous les Burgers</h2>
            {% if burgers %}
                <ul class="burgers">
                    {% for burger in burgers %}
                        <li>
                            <p><strong>{{ burger.name }}</strong> - Ingr√©dients : {{ burger.ingredients|join(", ") }}</p>
                            <p><strong>Cr√©ateur :</strong> {{ burger.creator }}</p>
                            <p><strong>Note moyenne :</strong> {{ burger.rating if burger.rating else "Aucune note" }}</p>
                            {% if session.get('user_id') %}
                            <form id="rate" action="{{ url_for('rate_burger', burger_id=burger._id) }}" method="POST">
                                <div class="rating" id="rating-{{ burger._id }}">
                                    <input type="radio" id="star5-{{ burger._id }}" name="rating" value="5" />
                                    <label for="star5-{{ burger._id }}" title="5 √©toiles">‚òÖ</label>

                                    <input type="radio" id="star4-{{ burger._id }}" name="rating" value="4" />
                                    <label for="star4-{{ burger._id }}" title="4 √©toiles">‚òÖ</label>

                                    <input type="radio" id="star3-{{ burger._id }}" name="rating" value="3" />
                                    <label for="star3-{{ burger._id }}" title="3 √©toiles">‚òÖ</label>

                                    <input type="radio" id="star2-{{ burger._id }}" name="rating" value="2" />
                                    <label for="star2-{{ burger._id }}" title="2 √©toiles">‚òÖ</label>

                                    <input type="radio" id="star1-{{ burger._id }}" name="rating" value="1" />
                                    <label for="star1-{{ burger._id }}" title="1 √©toile">‚òÖ</label>
                                </div>
                            </form>
                            <script>
                              // Requ√™te AJAX pour r√©cup√©rer la note de l'utilisateur pour ce burger
                              fetch("/rate_burger/{{ burger._id }}")
                                .then(response => response.json())
                                .then(data => {
                                  if (data.user_rating !== null) {
                                    // Si une note existe, cochez l'√©toile correspondante
                                    document.querySelector(`#star${data.user_rating}-{{ burger._id }}`).checked = true;
                                  }
                                })
                                .catch(err => console.error(err));
                            </script>
                            {% else %}
                            <p>Il faut se <a href="{{ url_for("login") }}">connecter</a> pour voter</p>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>Cr√©e le premier Burger de l'histoire</p>
            {% endif %}

            {% if session.get('user_id') %}
                <div>
                    <p>Bienvenue, {{ session['user_id'] }}</p>
                    <p>D√©couvrez Pimp My Burger, un site innovant o√π la cr√©ativit√© culinaire rencontre le plaisir du partage !</p>
                    <p >Rejoignez une communaut√© o√π chaque burger est une ≈ìuvre d‚Äôart et o√π vos id√©es peuvent devenir une inspiration pour d‚Äôautres. Burger Lab n‚Äôest pas juste un site, c‚Äôest une aventure culinaire interactive !
                        üëâ Pr√™t √† cr√©er le burger de vos r√™ves ?</p>
                    <a href="{{ url_for("create_burger") }}" class="btn btn-primary">Cr√©er un burger</a>
                </div>
                <div class="">

                <p>Cr√©ez votre burger id√©al √† partir de z√©ro en personnalisant chaque √©l√©ment :<br>
                    <br>
                    Choisissez votre pain : <br>
                    brioch√©, complet, au s√©same ou encore au charbon v√©g√©tal
                    <br>
                    Composez votre garniture : <br>
                    steak, poulet, options v√©g√©tariennes ou v√©ganes, et ajoutez des fromages savoureux, l√©gumes frais et sauces uniques
                    <br>
                    Ajoutez une touche personnelle<br>
                    Avec des ingr√©dients sp√©ciaux ou insolites pour cr√©er un chef-d'≈ìuvre qui vous ressemble
                </p>
                {% else %}
                    <p>Veuillez vous connecter pour cr√©er un burger.</p>
                {% endif %}
                </div>
            </div>
    </div>
    <div class="panel right-panel">
        <img class="image-burger" src="/static/images/burger.jpg" alt="">
    </div>
</main>
<script src="/static/script.js"></script>
</body>
</html>